<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Album</title>
  <style>
    :root { --gap: 10px; }
    body { margin:0; font-family:system-ui, Arial, sans-serif; background:#0b0c10; color:#e7e7e7; }

    header{
      padding:16px;
      border-bottom:1px solid rgba(255,255,255,.08);
      position:sticky; top:0;
      backdrop-filter: blur(8px);
      background: rgba(11,12,16,.75);
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .left{ display:flex; align-items:center; gap:12px; }
    .btn{
      border:1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.06);
      color:#e7e7e7;
      padding:8px 12px;
      border-radius:12px;
      cursor:pointer;
      text-decoration:none;
      font-size:13px;
    }
    h1{ margin:0; font-size:16px; }
    #count{ opacity:.8; font-size:13px; }

    .wrap{ padding:16px; }

    /* Masonry-style columns */
    .grid{ column-count:4; column-gap: var(--gap); }
    @media (max-width:1200px){ .grid{ column-count:3; } }
    @media (max-width:800px){ .grid{ column-count:2; } }
    @media (max-width:520px){ .grid{ column-count:1; } }

    .card{
      break-inside: avoid;
      margin: 0 0 var(--gap);
      border-radius: 14px;
      overflow: hidden;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      cursor: zoom-in;
    }
    .card img{ width:100%; height:auto; display:block; }

    .error{
      opacity:.85;
      padding:16px;
      max-width: 900px;
      line-height: 1.5;
    }
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,.82);
      padding:20px;
      z-index:999;
    }
    .lightbox.open{ display:flex; }
    .lightbox img{
      max-width: min(1200px, 95vw);
      max-height: 90vh;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .hint{ margin-top:10px; font-size:12px; opacity:.75; text-align:center; }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <a class="btn" href="index.html">‚Üê Back</a>
      <h1 id="title">Album</h1>
    </div>
    <div id="count"></div>
  </header>

  <div class="wrap">
    <div id="grid" class="grid"></div>
    <div id="err" class="error"></div>
  </div>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <div>
      <img id="lbImg" alt="Preview" />
      <div class="hint">Click anywhere (or press Esc) to close</div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const album = params.get("album");

    const titleEl = document.getElementById("title");
    const countEl = document.getElementById("count");
    const grid = document.getElementById("grid");
    const err = document.getElementById("err");

    const lightbox = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");

    function openLightbox(src) {
      lbImg.src = src;
      lightbox.classList.add("open");
      lightbox.setAttribute("aria-hidden", "false");
    }
    function closeLightbox() {
      lightbox.classList.remove("open");
      lightbox.setAttribute("aria-hidden", "true");
      lbImg.src = "";
    }
    lightbox.addEventListener("click", closeLightbox);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeLightbox();
    });

    async function loadAlbum() {
      if (!album) {
        err.innerHTML = `Missing <code>?album=</code> parameter. Go back and pick an album.`;
        return;
      }

      titleEl.textContent = decodeURIComponent(album);

      // Expect: photos/<album>/images.json (list of filenames within that album folder)
      const listUrl = `photos/${album}/images.json`;

      try {
        const res = await fetch(listUrl, { cache: "no-store" });
        if (!res.ok) throw new Error(`Could not load ${listUrl} (HTTP ${res.status})`);
        const files = await res.json();

        if (!Array.isArray(files) || files.length === 0) {
          err.innerHTML = `No images listed in <code>${listUrl}</code>.`;
          return;
        }

        countEl.textContent = `${files.length} photos`;

        files.forEach((name) => {
          const src = `photos/${album}/${name}`;
          const card = document.createElement("div");
          card.className = "card";

          const img = document.createElement("img");
          img.loading = "lazy";
          img.alt = name;
          img.src = src;

          card.appendChild(img);
          card.addEventListener("click", () => openLightbox(src));
          grid.appendChild(card);
        });
      } catch (e) {
        err.textContent = `Error: ${e.message}`;
      }
    }

    loadAlbum();
  </script>
</body>
</html>
